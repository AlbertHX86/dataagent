# 如何启动数据分析Agent

本文档提供Mac和Windows系统的详细启动指南。

---

## 🍎 Mac系统启动指南

### 前置要求

确保已安装：
- Python 3.8+ （推荐3.11或3.12，**支持3.13**）
- Node.js 14+
- npm 或 yarn

检查版本：
```bash
python3 --version
node --version
npm --version
```

### 步骤1: 安装后端依赖

打开终端（Terminal），执行：

```bash
# 进入后端目录
cd /Users/你的用户名/Desktop/DSagent/backend

# 创建虚拟环境
python3 -m venv venv

# 激活虚拟环境
source venv/bin/activate

# 升级pip
python -m pip install --upgrade pip

# 安装依赖
pip install -r ../requirements.txt
```

> 💡 **提示**: 首次安装可能需要3-5分钟，请耐心等待。

### 步骤2: 安装前端依赖

**打开新的终端窗口**，执行：

```bash
# 进入前端目录
cd /Users/你的用户名/Desktop/DSagent/frontend

# 安装依赖
npm install
```

> 💡 **提示**: 首次安装可能需要2-3分钟。

### 步骤3: 启动后端服务

在第一个终端（后端）中：

```bash
# 确保在backend目录
cd /Users/你的用户名/Desktop/DSagent/backend

# 激活虚拟环境（如果没有激活）
source venv/bin/activate

# 启动后端
python main.py
```

**成功启动后会看到**：
```
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000
```

✅ **保持这个终端窗口开启！**

### 步骤4: 启动前端服务

在第二个终端（前端）中：

```bash
# 确保在frontend目录
cd /Users/你的用户名/Desktop/DSagent/frontend

# 启动前端
npm start
```

**启动成功后**：
- 浏览器会自动打开 http://localhost:3000
- 如果没有自动打开，手动访问该地址

✅ **保持这个终端窗口开启！**

### 步骤5: 开始使用

浏览器打开后：
1. 点击"登录"按钮（演示版可直接进入）
2. 上传 `example_data.csv` 测试数据
3. 输入分析需求，开始使用！

### Mac快捷启动脚本（可选）

创建启动脚本 `start_mac.sh`：

```bash
#!/bin/bash

# 启动后端
cd backend
source venv/bin/activate
python main.py > backend.log 2>&1 &
echo "后端启动中..."

# 启动前端
cd ../frontend
npm start > frontend.log 2>&1 &
echo "前端启动中..."

echo "服务启动完成！"
echo "前端: http://localhost:3000"
echo "后端: http://localhost:8000"
```

使用方法：
```bash
chmod +x start_mac.sh
./start_mac.sh
```

### Mac停止服务

在终端中按 `Ctrl + C` 停止正在运行的服务。

或者使用命令：
```bash
# 停止后端
lsof -ti:8000 | xargs kill -9

# 停止前端
lsof -ti:3000 | xargs kill -9
```

---

## 🪟 Windows系统启动指南

### 前置要求

确保已安装：
- Python 3.8+ （推荐3.11或3.12）
- Node.js 14+
- npm

检查版本：
```cmd
python --version
node --version
npm --version
```

### 步骤1: 安装后端依赖

打开命令提示符（CMD）或PowerShell，执行：

```cmd
:: 进入后端目录
cd C:\Users\你的用户名\Desktop\DSagent\backend

:: 创建虚拟环境
python -m venv venv

:: 激活虚拟环境
venv\Scripts\activate

:: 升级pip
python -m pip install --upgrade pip

:: 安装依赖
pip install -r ..\requirements.txt
```

> 💡 **提示**: 首次安装可能需要3-5分钟，请耐心等待。

### 步骤2: 安装前端依赖

**打开新的命令提示符窗口**，执行：

```cmd
:: 进入前端目录
cd C:\Users\你的用户名\Desktop\DSagent\frontend

:: 安装依赖
npm install
```

> 💡 **提示**: 首次安装可能需要2-3分钟。

### 步骤3: 启动后端服务

在第一个命令提示符窗口（后端）中：

```cmd
:: 确保在backend目录
cd C:\Users\你的用户名\Desktop\DSagent\backend

:: 激活虚拟环境（如果没有激活）
venv\Scripts\activate

:: 启动后端
python main.py
```

**成功启动后会看到**：
```
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000
```

✅ **保持这个窗口开启！**

### 步骤4: 启动前端服务

在第二个命令提示符窗口（前端）中：

```cmd
:: 确保在frontend目录
cd C:\Users\你的用户名\Desktop\DSagent\frontend

:: 启动前端
npm start
```

**启动成功后**：
- 浏览器会自动打开 http://localhost:3000
- 如果没有自动打开，手动访问该地址

✅ **保持这个窗口开启！**

### 步骤5: 开始使用

浏览器打开后：
1. 点击"登录"按钮（演示版可直接进入）
2. 上传 `example_data.csv` 测试数据
3. 输入分析需求，开始使用！

### Windows快捷启动脚本（可选）

创建启动脚本 `start_windows.bat`：

```batch
@echo off
echo 启动数据分析Agent...

:: 启动后端
start "Backend" cmd /k "cd backend && venv\Scripts\activate && python main.py"

:: 等待2秒
timeout /t 2 /nobreak > nul

:: 启动前端
start "Frontend" cmd /k "cd frontend && npm start"

echo 服务启动完成！
echo 前端: http://localhost:3000
echo 后端: http://localhost:8000
pause
```

双击 `start_windows.bat` 文件即可启动。

### Windows停止服务

在各个命令提示符窗口中按 `Ctrl + C` 停止服务。

或者使用命令：
```cmd
:: 停止后端
taskkill /F /IM python.exe

:: 停止前端
taskkill /F /IM node.exe
```

---

## 📍 访问地址

启动成功后，访问以下地址：

| 服务 | 地址 | 说明 |
|------|------|------|
| 🌐 前端应用 | http://localhost:3000 | Web界面 |
| 🔧 后端API | http://localhost:8000 | API服务 |
| 📚 API文档 | http://localhost:8000/docs | Swagger UI |
| 💚 健康检查 | http://localhost:8000/health | 服务状态 |

---

## ❓ 常见问题

### 1. 端口被占用？

**Mac:**
```bash
# 查看占用端口的进程
lsof -ti:8000
lsof -ti:3000

# 杀掉进程
lsof -ti:8000 | xargs kill -9
lsof -ti:3000 | xargs kill -9
```

**Windows:**
```cmd
:: 查看占用端口的进程
netstat -ano | findstr :8000
netstat -ano | findstr :3000

:: 杀掉进程（替换PID为实际进程ID）
taskkill /PID <PID> /F
```

### 2. Python命令不存在？

**Mac:** 尝试使用 `python3` 而不是 `python`

**Windows:** 
- 确保Python已添加到PATH
- 尝试使用 `py` 命令：`py -m venv venv`

### 3. npm install失败？

清理缓存后重试：
```bash
# Mac/Windows都适用
npm cache clean --force
rm -rf node_modules package-lock.json  # Mac
rmdir /s node_modules & del package-lock.json  # Windows
npm install
```

### 4. 虚拟环境激活失败？

**Mac:** 确保使用 `source venv/bin/activate`

**Windows PowerShell:** 
```powershell
# 如果提示执行策略错误，先运行：
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
# 然后激活：
venv\Scripts\Activate.ps1
```

**Windows CMD:** 
```cmd
venv\Scripts\activate.bat
```

### 5. 后端导入模块失败？

确保虚拟环境已激活，并且所有依赖已安装：
```bash
# Mac
source venv/bin/activate
pip list

# Windows  
venv\Scripts\activate
pip list
```

如果缺少依赖，重新安装：
```bash
pip install -r requirements.txt
```

### 6. 前端编译错误？

尝试删除并重新安装依赖：
```bash
# 删除node_modules
rm -rf node_modules  # Mac
rmdir /s node_modules  # Windows

# 重新安装
npm install
```

---

## 🔧 验证安装

### 测试后端

```bash
curl http://localhost:8000/
```

应该返回：
```json
{
  "message": "欢迎使用数据分析Agent API",
  "version": "1.0.0",
  "docs": "/docs"
}
```

### 测试前端

在浏览器中打开 http://localhost:3000，应该看到数据分析Agent的首页。

---

## 📊 快速体验

1. **上传示例数据**: 使用项目根目录的 `example_data.csv`
2. **输入分析需求**: 例如"分析销售趋势和地区分布"
3. **查看结果**: 系统自动生成图表和洞察
4. **尝试预测**: 选择目标列进行时间序列预测

---

## 📚 相关文档

- `README.md` - 项目总览
- `QUICK_START.md` - 快速开始指南  
- `FEATURES.md` - 功能详解
- `ARCHITECTURE.md` - 系统架构
- `INSTALL.md` - 安装指南

---

## 💡 提示

- **首次启动**: 需要等待依赖安装，可能需要5-10分钟
- **后续启动**: 只需要执行步骤3和步骤4，通常1-2分钟即可启动
- **开发模式**: 前端支持热重载，修改代码后自动刷新
- **生产部署**: 查看 `ARCHITECTURE.md` 了解部署方案

---

## 🎉 开始使用

所有服务启动成功后，打开浏览器访问：

**http://localhost:3000**

享受智能数据分析的便利吧！

---

**更新时间**: 2024年10月27日  
**版本**: 1.0.0

